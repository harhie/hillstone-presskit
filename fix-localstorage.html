<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix LocalStorage</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #ff6b35;
            margin-bottom: 20px;
        }
        .btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            margin: 10px 5px;
            width: 100%;
        }
        .btn:hover {
            background: #e85a2a;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }
        .success {
            background: #d4edda;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        #status {
            margin-top: 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ LocalStorage ë³µêµ¬ ë„êµ¬</h1>
        
        <div class="info">
            <strong>ğŸ’¡ ì‚¬ìš© ë°©ë²•:</strong><br>
            ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ê´€ë¦¬ì í˜ì´ì§€ì˜ ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³  ë³µêµ¬í•©ë‹ˆë‹¤.
        </div>

        <button class="btn" onclick="checkAndFix()">
            ğŸ” 1ë‹¨ê³„: ë°ì´í„° í™•ì¸ ë° ë¶„ì„
        </button>

        <button class="btn" onclick="loadFromGithubRaw()">
            ğŸ“¥ 2ë‹¨ê³„: GitHubì—ì„œ ì§ì ‘ ë‹¤ìš´ë¡œë“œ
        </button>

        <div id="status"></div>
    </div>

    <script>
        function checkAndFix() {
            const statusDiv = document.getElementById('status');
            const stored = localStorage.getItem('hillstone_press_items');
            
            if (!stored) {
                statusDiv.innerHTML = `
                    <div class="info">
                        <strong>ğŸ“Š í˜„ì¬ ìƒíƒœ:</strong><br>
                        LocalStorageì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.<br><br>
                        <strong>ë‹¤ìŒ ë‹¨ê³„:</strong><br>
                        "2ë‹¨ê³„: GitHubì—ì„œ ì§ì ‘ ë‹¤ìš´ë¡œë“œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                    </div>
                `;
                return;
            }

            try {
                const items = JSON.parse(stored);
                statusDiv.innerHTML = `
                    <div class="success">
                        <strong>âœ… ë°ì´í„° ë°œê²¬!</strong><br>
                        LocalStorageì— <strong>${items.length}ê°œ</strong>ì˜ ê¸°ì‚¬ê°€ ìˆìŠµë‹ˆë‹¤.<br><br>
                        <strong>ì¹´í…Œê³ ë¦¬ë³„:</strong><br>
                        - ê¸°ì‚¬: ${items.filter(i => i.category === 'article').length}ê°œ<br>
                        - í•´ì™¸ê¸°ì‚¬: ${items.filter(i => i.category === 'foreign').length}ê°œ<br>
                        - ê³µì§€: ${items.filter(i => i.category === 'photo').length}ê°œ<br>
                        - ì˜ìƒ: ${items.filter(i => i.category === 'video').length}ê°œ<br><br>
                        ${items.length >= 90 ? 
                            '<strong>âœ… ë°ì´í„°ê°€ ì •ìƒì…ë‹ˆë‹¤! newsroom.htmlì„ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.</strong>' : 
                            '<strong>âš ï¸ ê¸°ì‚¬ ìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. 2ë‹¨ê³„ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</strong>'}
                    </div>
                `;
            } catch (e) {
                statusDiv.innerHTML = `
                    <div class="error">
                        âŒ ë°ì´í„°ê°€ ì†ìƒë˜ì—ˆìŠµë‹ˆë‹¤: ${e.message}<br>
                        2ë‹¨ê³„ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
                    </div>
                `;
            }
        }

        async function loadFromGithubRaw() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<div class="info">â³ GitHubì—ì„œ ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ëŠ” ì¤‘...</div>';

            const urls = [
                'https://raw.githubusercontent.com/harhie/hillstone-presskit/main/js/main.js',
                'https://raw.githubusercontent.com/harhie/hillstone-presskit/master/js/main.js'
            ];

            for (const url of urls) {
                try {
                    console.log('Trying:', url);
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        console.log('Failed:', response.status);
                        continue;
                    }

                    const text = await response.text();
                    console.log('Downloaded:', text.length, 'bytes');

                    // getSampleData í•¨ìˆ˜ ì „ì²´ë¥¼ ì¶”ì¶œ
                    const regex = /function\s+getSampleData\s*\(\s*\)\s*\{([\s\S]*?)\n\}/;
                    const match = text.match(regex);

                    if (!match) {
                        console.log('getSampleData not found');
                        continue;
                    }

                    const functionBody = match[1];
                    console.log('Function body extracted');

                    // return ë¬¸ì—ì„œ ë°°ì—´ ì¶”ì¶œ
                    const returnMatch = functionBody.match(/return\s+(\[[\s\S]*\])\s*;?/);
                    
                    if (!returnMatch) {
                        console.log('Return statement not found');
                        continue;
                    }

                    const arrayStr = returnMatch[1];
                    console.log('Array string length:', arrayStr.length);

                    // ë°°ì—´ í‰ê°€
                    let items;
                    try {
                        // generateId í•¨ìˆ˜ ì •ì˜ (í•„ìš”í•œ ê²½ìš°)
                        function generateId() {
                            return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        }
                        
                        items = eval(arrayStr);
                    } catch (evalError) {
                        console.error('Eval error:', evalError);
                        throw new Error('ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨: ' + evalError.message);
                    }

                    if (!Array.isArray(items) || items.length === 0) {
                        throw new Error('ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
                    }

                    console.log('Items loaded:', items.length);

                    // LocalStorageì— ì €ì¥
                    localStorage.setItem('hillstone_press_items', JSON.stringify(items));

                    statusDiv.innerHTML = `
                        <div class="success">
                            <strong>âœ… ì„±ê³µ!</strong><br>
                            GitHubì—ì„œ <strong>${items.length}ê°œ</strong>ì˜ ê¸°ì‚¬ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!<br><br>
                            <strong>ë‹¤ìŒ ë‹¨ê³„:</strong><br>
                            1. <code>newsroom.html</code>ì„ <strong>ì™„ì „íˆ ìƒˆë¡œê³ ì¹¨</strong>í•˜ì„¸ìš”<br>
                            &nbsp;&nbsp;&nbsp;(Ctrl+Shift+R ë˜ëŠ” Cmd+Shift+R)<br>
                            2. <code>newsroom-admin.html</code>ì—ì„œë„ í™•ì¸í•˜ì„¸ìš”<br>
                            3. ì „ì²´(${items.length}) í‘œì‹œë¥¼ í™•ì¸í•˜ì„¸ìš”<br><br>
                            <strong>ğŸ‰ ì™„ë£Œ!</strong>
                        </div>
                    `;
                    return;

                } catch (error) {
                    console.error('Error with URL:', url, error);
                }
            }

            // ëª¨ë“  URL ì‹¤íŒ¨
            statusDiv.innerHTML = `
                <div class="error">
                    <strong>âŒ ì‹¤íŒ¨!</strong><br>
                    GitHubì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><br>
                    <strong>í™•ì¸ì‚¬í•­:</strong><br>
                    1. GitHub ì €ì¥ì†Œê°€ ì¡´ì¬í•˜ë‚˜ìš”?<br>
                    &nbsp;&nbsp;&nbsp;https://github.com/harhie/hillstone-presskit<br>
                    2. js/main.js íŒŒì¼ì´ ìˆë‚˜ìš”?<br>
                    3. ì €ì¥ì†Œê°€ publicì¸ê°€ìš”?<br><br>
                    <strong>F12 ì½˜ì†”ì—ì„œ ìƒì„¸ ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.</strong>
                </div>
            `;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í™•ì¸
        window.addEventListener('load', checkAndFix);
    </script>
</body>
</html>
