<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Load</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #ff6b35;
        }
        .btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            margin: 10px 0;
            width: 100%;
        }
        .btn:hover {
            background: #e85a2a;
        }
        #status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Direct Load (ìµœì¢… í•´ê²°ì±…)</h1>
        
        <p><strong>í˜„ì¬ LocalStorage:</strong> <span id="currentCount">í™•ì¸ ì¤‘...</span></p>
        
        <button class="btn" onclick="loadDirectly()">
            ğŸ“¥ GitHubì—ì„œ ì§ì ‘ ë‹¤ìš´ë¡œë“œ (ìµœì¢…)
        </button>
        
        <div id="status"></div>
    </div>

    <script>
        // í˜„ì¬ ê°œìˆ˜ í‘œì‹œ
        window.addEventListener('load', () => {
            const stored = localStorage.getItem('hillstone_press_items');
            const count = stored ? JSON.parse(stored).length : 0;
            document.getElementById('currentCount').textContent = count + 'ê°œ';
        });

        async function loadDirectly() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<div class="info">â³ ë‹¤ìš´ë¡œë“œ ì¤‘...</div>';

            try {
                // GitHub Raw URLì—ì„œ ì§ì ‘ ë‹¤ìš´ë¡œë“œ
                const url = 'https://raw.githubusercontent.com/harhie/hillstone-presskit/main/js/main.js';
                
                const response = await fetch(url, {
                    cache: 'no-cache',
                    headers: {
                        'Cache-Control': 'no-cache'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const text = await response.text();
                console.log('Downloaded:', text.length, 'bytes');

                // getSampleData í•¨ìˆ˜ ì „ì²´ ì¶”ì¶œ - ë” ì •í™•í•œ ì •ê·œì‹
                const functionRegex = /function\s+getSampleData\s*\(\s*\)\s*\{[\s\S]*?\n\}/m;
                const functionMatch = text.match(functionRegex);

                if (!functionMatch) {
                    throw new Error('getSampleData í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }

                console.log('Function found');

                // return ë¬¸ ì¶”ì¶œ - ê°œì„ ëœ ì •ê·œì‹
                const returnRegex = /return\s+(\[[\s\S]*?\])\s*;/;
                const returnMatch = functionMatch[0].match(returnRegex);

                if (!returnMatch) {
                    throw new Error('return ë¬¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }

                const arrayStr = returnMatch[1];
                console.log('Array extracted, length:', arrayStr.length);

                // ì•ˆì „í•˜ê²Œ í‰ê°€
                let items;
                try {
                    // generateId í•¨ìˆ˜ ì •ì˜ (í•„ìš”ì‹œ)
                    function generateId() {
                        return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    }

                    // ë°°ì—´ í‰ê°€
                    items = eval('(' + arrayStr + ')');
                    
                    console.log('Eval successful, items:', items.length);
                } catch (e) {
                    console.error('Eval error:', e);
                    throw new Error('ë°°ì—´ íŒŒì‹± ì‹¤íŒ¨: ' + e.message);
                }

                // ê²€ì¦
                if (!Array.isArray(items)) {
                    throw new Error('ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤');
                }

                if (items.length === 0) {
                    throw new Error('ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤');
                }

                console.log('Items validated:', items.length);

                // LocalStorageì— ì €ì¥ - ì—¬ëŸ¬ ë²ˆ ì‹œë„
                for (let i = 0; i < 3; i++) {
                    try {
                        localStorage.setItem('hillstone_press_items', JSON.stringify(items));
                        console.log('Saved to LocalStorage, attempt', i + 1);
                        
                        // ì €ì¥ í™•ì¸
                        const verification = localStorage.getItem('hillstone_press_items');
                        const verifiedItems = JSON.parse(verification);
                        
                        if (verifiedItems.length === items.length) {
                            console.log('Verification successful!');
                            break;
                        } else {
                            console.warn('Verification failed, retrying...');
                        }
                    } catch (e) {
                        console.error('Save error:', e);
                        if (i === 2) throw e;
                    }
                }

                // ìµœì¢… í™•ì¸
                const finalCheck = localStorage.getItem('hillstone_press_items');
                const finalItems = JSON.parse(finalCheck);

                statusDiv.innerHTML = `
                    <div class="success">
                        <strong>âœ… ì„±ê³µ!</strong><br>
                        <strong>${finalItems.length}ê°œ</strong> ê¸°ì‚¬ë¥¼ LocalStorageì— ì €ì¥í–ˆìŠµë‹ˆë‹¤!<br><br>
                        <strong>ê²€ì¦ ì™„ë£Œ:</strong><br>
                        - ë‹¤ìš´ë¡œë“œ: ${items.length}ê°œ<br>
                        - ì €ì¥ë¨: ${finalItems.length}ê°œ<br>
                        - ì¼ì¹˜: ${items.length === finalItems.length ? 'âœ…' : 'âŒ'}<br><br>
                        <strong>ğŸ‰ ë‹¤ìŒ ë‹¨ê³„:</strong><br>
                        1. <code>newsroom.html</code>ì„ ì—´ì–´ì£¼ì„¸ìš”<br>
                        2. <strong>Ctrl+Shift+R</strong>ë¡œ ì™„ì „ ìƒˆë¡œê³ ì¹¨<br>
                        3. ì „ì²´(${finalItems.length}) í‘œì‹œ í™•ì¸!<br><br>
                        <strong>ì¹´í…Œê³ ë¦¬ë³„:</strong><br>
                        - ê¸°ì‚¬: ${finalItems.filter(i => i.category === 'article').length}ê°œ<br>
                        - í•´ì™¸ê¸°ì‚¬: ${finalItems.filter(i => i.category === 'foreign').length}ê°œ<br>
                        - ê³µì§€: ${finalItems.filter(i => i.category === 'photo').length}ê°œ<br>
                        - ì˜ìƒ: ${finalItems.filter(i => i.category === 'video').length}ê°œ
                    </div>
                `;

                // í˜„ì¬ ê°œìˆ˜ ì—…ë°ì´íŠ¸
                document.getElementById('currentCount').textContent = finalItems.length + 'ê°œ';

            } catch (error) {
                console.error('Error:', error);
                statusDiv.innerHTML = `
                    <div class="error">
                        <strong>âŒ ì‹¤íŒ¨!</strong><br>
                        ${error.message}<br><br>
                        <strong>F12 ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.</strong>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
